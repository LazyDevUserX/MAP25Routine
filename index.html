<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Syllabus Progress Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .chapter { margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
    .chapter-title { font-weight: bold; margin-bottom: 5px; }
    #progress-container { margin: 20px 0; width: 100%; background: #eee; border-radius: 6px; overflow: hidden; }
    #progress-bar { height: 20px; background: #4caf50; width: 0%; transition: width 0.3s; }
    #progress-text { margin-top: 5px; font-weight: bold; }
    #user-info { display: none; margin-bottom: 15px; }
    #syllabus-container input { margin-right: 8px; }
    button { padding: 6px 12px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>📘 Syllabus Progress Tracker</h1>

  <!-- Google Sign-in -->
  <div id="auth-container">
    <h2 id="auth-heading">Sign In to Sync Your Progress</h2>
    <p id="auth-p">Sign in with your Google account to save your progress.</p>
    <div id="google-signin-btn"></div>
  </div>

  <!-- User Info -->
  <div id="user-info">
    <p>👤 Signed in as <span id="user-name"></span></p>
    <button id="signout-btn">Sign Out</button>
  </div>

  <!-- Progress -->
  <div id="progress-and-syllabus" style="display:none;">
    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>
    <div id="progress-text">0%</div>
    <button id="resetBtn">Reset Progress</button>
    <hr>
    <div id="syllabus-container"></div>
  </div>

<script>
  // --- CONFIG ---
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwhk9fUo_97zefctLSb-dVHhJin7jGFa2IfX9xZNyJ6ouEn0OZH8Gy_3lrToJ8LMCgL/exec";
  const GOOGLE_CLIENT_ID = "18826900841-c4acnsq9n5bvrbd7dg82kk7f03tfrrmu.apps.googleusercontent.com";

  let totalItems = 0;
  let currentUser = null;

  // --- Syllabus Data ---
  const syllabusData = { /* 🔽 Your full syllabus JSON pasted here 🔽 */
    "Biology (B)": {
      "B-01": ["Part 1: ২য় পত্র অধ্যায়-০৪ : মানব শারীরতত্ত্ব : রক্ত ও সঞ্চালন (হৃৎপিণ্ডের আগে পর্যন্ত)", "GK: বাংলাদেশ পরিচিতি (ভৌগোলিক অবস্থান, আয়তন, সীমান্ত, ছিটমহল, জাতীয় বিষয়াবলি)"],
      "B-02": ["Part 1: ২য় পত্র অধ্যায়-০৩ : মানব শারীরতত্ত্ব : পরিপাক ও শোষণ (আন্ত্রিক গ্রন্থি পর্যন্ত)", "GK: বাংলাদেশের পানি সম্পদ (বঙ্গোপসাগর, সমুদ্র সৈকত, দ্বীপ, নদ-নদী, পানি বণ্টন চুক্তি, সেচ প্রকল্প, বাঁধ ও বন্যা নিয়ন্ত্রণ, পানি শোধনাগার, প্রাকৃতিক দুর্যোগ)"],
      "B-03": ["Part 1: ১ম পত্র অধ্যায়-০২ : কোষ বিভাজন, ১ম পত্র অধ্যায়-০৩ : কোষ রসায়ন (কার্বোহাইড্রেট)", "GK: পাকিস্তান আমলে বাংলাদেশ", "Part 2: ১ম পত্র অধ্যায়-০৩ : কোষ রসায়ন (এমিনো এসিড, প্রোটিন, লিপিড, এনজাইম)", "English: Parts of Speech Identification, Appropriate Preposition (B)"],
      "B-04": ["Part 1: ১ম পত্র অধ্যায়-০১ : কোষ ও এর গঠন (কোষ গহ্বর পর্যন্ত)", "GK: বাংলাদেশের শিক্ষা, স্বাস্থ্য ও জনসংখ্যা", "Part 2: ১ম পত্র অধ্যায়-০১ : কোষ ও এর গঠন (নিউক্লিয়াস থেকে শেষ পর্যন্ত)", "English: Sentence & Its Classification, Transformation of Sentence"],
      "B-05": ["Part 1: ২য় পত্র অধ্যায়-০৮ : মানব শারীরতত্ত্ব : সমন্বয় ও নিয়ন্ত্রণ (স্নায়ুবিক সমন্বয়)", "GK: বাংলাদেশের সংবিধান ও রাজনৈতিক ব্যবস্থা (আইন ও বিচার বিভাগ, বিভিন্ন কমিশন)", "Part 2: ২য় পত্র অধ্যায়-০১ : প্রাণির বিভিন্নতা ও শ্রেণিবিন্যাস", "English: Tense and Its Identification, Sequence of Tense, Synonym & Antonym (E, F)"],
      "B-06": ["Part 1: ২য় পত্র অধ্যায়-০৮ : মানব শারীরতত্ত্ব : সমন্বয় ও নিয়ন্ত্রণ (চোখ, কান, রাসায়নিক সমন্বয়)", "GK: গণমাধ্যম, শিল্প ও সংস্কৃতি (বাংলাদেশের বিখ্যাত ব্যক্তিবর্গ, ঐতিহাসিক স্থান ও দর্শনীয় স্থাপনা)", "Part 2: ২য় পত্র অধ্যায়-০৫ : মানব শারীরতত্ত্ব : শ্বসন ও শ্বাসক্রিয়া", "English: Right Form of Verbs, Causative Verb, Subjunctive"]
    },
    "Chemistry (C)": {
      "C-01": ["Part 1: ১ম পত্র অধ্যায়-০২: গুণগত রসায়ন (ইলেকট্রন বিন্যাসের আগ পর্যন্ত)", "GK: বাংলাদেশ পরিচিতি (ভূ-প্রকৃতি, পাহাড়-পর্বত, উপত্যকা, জলপ্রপাত, ঝর্ণা, হ্রদ, চর, বিল, হাওড়-বাওড়, ভৌগোলিক উপনাম)", "Part 2: ১ম পত্র অধ্যায়-০২: গুণগত রসায়ন (ইলেকট্রন বিন্যাস থেকে দ্রাব্যতার আগ পর্যন্ত)", "English: Number Gender, Pronoun, Appropriate Preposition (A)"]
      // 🔽 Continue with Chemistry, Physics, English, GK data from your syllabus JSON 🔽
    }
  };

  // --- AUTH LOGIC ---
  function handleCredentialResponse(response) {
    const data = parseJwt(response.credential);
    currentUser = { id: data.sub, name: data.name, email: data.email };
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
    showUserUI();
    loadProgress();
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
      '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
    return JSON.parse(jsonPayload);
  }

  function showUserUI() {
    document.getElementById("user-name").textContent = currentUser.name;
    document.getElementById("auth-container").style.display = "none";
    document.getElementById("user-info").style.display = "block";
    document.getElementById("progress-and-syllabus").style.display = "block";
  }

  function hideUserUI() {
    document.getElementById("auth-container").style.display = "block";
    document.getElementById("user-info").style.display = "none";
    document.getElementById("progress-and-syllabus").style.display = "none";
  }

  window.onload = function () {
    const saved = localStorage.getItem("currentUser");
    renderSyllabus();
    setupEventListeners();

    if (saved) {
      currentUser = JSON.parse(saved);
      showUserUI();
      loadProgress();
    }

    google.accounts.id.initialize({
      client_id: GOOGLE_CLIENT_ID,
      callback: handleCredentialResponse,
      auto_select: true
    });

    google.accounts.id.renderButton(
      document.getElementById("google-signin-btn"),
      { theme: "outline", size: "large" }
    );
  };

  document.getElementById("signout-btn").addEventListener("click", () => {
    currentUser = null;
    localStorage.removeItem("currentUser");
    google.accounts.id.disableAutoSelect();
    hideUserUI();
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    updateProgress();
  });

  // --- PROGRESS LOGIC ---
  function updateProgress() {
    const checkedItems = document.querySelectorAll('input[type="checkbox"]:checked').length;
    const percentage = totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;
    document.getElementById("progress-bar").style.width = `${percentage}%`;
    document.getElementById("progress-text").textContent = `${percentage}%`;
  }

  async function saveProgress() {
    if (!currentUser) return;
    const checkedIds = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.id);
    try {
      await fetch(WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: currentUser.id, checkedIds })
      });
    } catch (err) { console.error("Save error:", err); }
  }

  async function loadProgress() {
    if (!currentUser) return;
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    updateProgress();
    try {
      const res = await fetch(`${WEB_APP_URL}?userId=${currentUser.id}`);
      const data = await res.json();
      if (data.checkedIds) {
        data.checkedIds.split(",").forEach(id => {
          const cb = document.getElementById(id);
          if (cb) cb.checked = true;
        });
      }
      updateProgress();
    } catch (err) { console.error("Load error:", err); }
  }

  function setupEventListeners() {
    document.getElementById("syllabus-container").addEventListener("change", e => {
      if (e.target.type === "checkbox") {
        updateProgress();
        saveProgress();
      }
    });
    document.getElementById("resetBtn").addEventListener("click", () => {
      if (confirm("Reset all progress?")) {
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        updateProgress();
        saveProgress();
      }
    });
  }

  // --- RENDER SYLLABUS ---
  function renderSyllabus() {
    const container = document.getElementById("syllabus-container");
    container.innerHTML = "";
    totalItems = 0;
    for (const subject in syllabusData) {
      const subjectDiv = document.createElement("div");
      subjectDiv.innerHTML = `<h2>${subject}</h2>`;
      for (const chapter in syllabusData[subject]) {
        const chapterDiv = document.createElement("div");
        chapterDiv.className = "chapter";
        chapterDiv.innerHTML = `<div class="chapter-title">${chapter}</div>`;
        syllabusData[subject][chapter].forEach((topic, idx) => {
          totalItems++;
          const id = `${chapter}-${idx}`;
          chapterDiv.innerHTML += `<label><input type="checkbox" id="${id}"> ${topic}</label><br>`;
        });
        subjectDiv.appendChild(chapterDiv);
      }
      container.appendChild(subjectDiv);
    }
  }
</script>
</body>
</html>
